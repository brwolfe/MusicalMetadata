<!DOCTYPE html>
<html>
  <head>
    <title>Band List</title>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <div id="display"></div>
    <button id="albums-button" class="toggle" type="button">View albums</button>
    <button id="artists-button" class="toggle" type="button">View artists</button>
    <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script>
var loaded = null;
function load(path) {
  if (path === loaded) { return; }
  $.get(path, function (data) {
    loaded = path;
    $('#display').html(data);
    $('.toggle').toggle();
    $("a").click(onLinkClick);
    $("form").submit(onFormSubmit);
  });
}
function onLinkClick(click) {
  click.preventDefault();
  var href = $(this).attr('href');
  if (href == '/') { load('/artists/'); }
  else { load(href); }
}
function onFormSubmit(submit) {
  submit.preventDefault();
  var form = $(this);
  var o = { 
    url: form.attr('action'),
    type: form.attr('method'),
    data: form.serialize(),
    success: function(data, status, xhr) {
      if (status == 'success') {
        load(xhr.getResponseHeader('Location'));
      } else {
        $('#display').html('<span class="error">Hmmm... something broke.</span>');
      } 
    }
  };
  if (o.type == 'put' && 'item[id]' in this.elements) {
    o.url += this.elements['item[id]'].value;
    o.data = o.data.split('&').slice(1).join('&');
  }
  $.ajax(o);
}
load('/artists/');
$('#artists-button').click(function() { load('/artists/'); });
$('#albums-button').click(function() { load('/albums/'); });
    </script>
  </body>
</html>